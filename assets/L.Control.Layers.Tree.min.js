!function(_){if(void 0===_)throw new Error("Leaflet must be included first");_.Control.Layers.Tree=_.Control.Layers.extend({options:{closedSymbol:"+",openedSymbol:"&minus;",spaceSymbol:" ",selectorBack:!1,namedToggle:!1,collapseAll:"",expandAll:""},_initClassesNames:function(){this.cls={children:"leaflet-layerstree-children",childrenNopad:"leaflet-layerstree-children-nopad",hide:"leaflet-layerstree-hide",closed:"leaflet-layerstree-closed",opened:"leaflet-layerstree-opened",space:"leaflet-layerstree-header-space",pointer:"leaflet-layerstree-header-pointer",header:"leaflet-layerstree-header",neverShow:"leaflet-layerstree-nevershow",node:"leaflet-layerstree-node",name:"leaflet-layerstree-header-name",label:"leaflet-layerstree-header-label"}},initialize:function(e,t,s){this._scrollTop=0,this._initClassesNames(),this._baseTree=null,this._overlaysTree=null,_.Util.setOptions(this,s),_.Control.Layers.prototype.initialize.call(this,null,null,s),this._setTrees(e,t)},setBaseTree:function(e){return this._setTrees(e)},setOverlayTree:function(e){return this._setTrees(void 0,e)},addBaseLayer:function(e,t){throw"addBaseLayer is disabled"},addOverlay:function(e,t){throw"addOverlay is disabled"},removeLayer:function(e){throw"removeLayer is disabled"},collapse:function(){return this._scrollTop=this._sect().scrollTop,_.Control.Layers.prototype.collapse.call(this)},expand:function(){_.Control.Layers.prototype.expand.call(this);this._sect().scrollTop=this._scrollTop},onAdd:function(e){function t(e){e._layersTreeName&&(s.innerHTML=e._layersTreeName)}var s,l=_.Control.Layers.prototype.onAdd.call(this,e);return this.options.namedToggle&&(s=this._container.getElementsByClassName("leaflet-control-layers-toggle")[0],_.DomUtil.addClass(s,"leaflet-layerstree-named-toggle"),e.eachLayer(function(e){t(e)}),e.on("baselayerchange",function(e){t(e.layer)},this)),l},expandTree:function(e){e=e?this._overlaysList:this._baseLayersList;return e&&this._applyOnTree(e,!1),this._localExpand()},collapseTree:function(e){e=e?this._overlaysList:this._baseLayersList;return e&&this._applyOnTree(e,!0),this._localExpand()},expandSelected:function(e){var l=this,t=e?this._overlaysList:this._baseLayersList;if(!t)return this;for(var a=this.cls.hide,s=this._layerControlInputs||t.getElementsByTagName("input"),r=0;r<s.length;r++){var i=s[r];this._getLayer&&!!this._getLayer(i.layerId).overlay!=!!e||i.checked&&!function e(t){var s=t.parentElement;s&&(_.DomUtil.hasClass(s,l.cls.children)&&!_.DomUtil.hasClass(t,l.cls.childrenNopad)&&_.DomUtil.removeClass(s,a),_.DomUtil.hasClass(s,l.cls.node)&&(t=s.getElementsByClassName(l.cls.header)[0],l._applyOnTree(t,!1)),e(s))}(i.parentElement.parentElement.parentElement.parentElement)}return this._localExpand()},_sect:function(){return this._section||this._form},_setTrees:function(e,t){var l=0;function a(e,t,s){return e&&e.layer&&(s||(e.layer._layersTreeName=e.name||e.label),t[l++]=e.layer),e&&e.children&&e.children.length&&e.children.forEach(function(e){a(e,t,s)}),t}function s(e){return Array.isArray(e)?{noShow:!0,children:e}:e}this._layerControlInputs&&(this._layerControlInputs=[]);for(var r=0;r<this._layers.length;++r)this._layers[r].layer.off("add remove",this._onLayerChange,this);this._layers=[],void 0!==e&&(this._baseTree=s(e)),void 0!==t&&(this._overlaysTree=s(t));var i=a(this._baseTree,{});for(r in i)this._addLayer(i[r],r);var n=a(this._overlaysTree,{},!0);for(r in n)this._addLayer(n[r],r,!0);return this._map?this._update():this},_localExpand:function(){var e;return this._map&&_.DomUtil.hasClass(this._container,"leaflet-control-layers-expanded")&&(e=this._sect().scrollTop,this.expand(),this._sect().scrollTop=e,this._scrollTop=e),this},_applyOnTree:function(a,e){[{cls:this.cls.children,hide:e},{cls:this.cls.opened,hide:e},{cls:this.cls.closed,hide:!e}].forEach(function(e){for(var t=a.getElementsByClassName(e.cls),s=0;s<t.length;s++){var l=t[s];_.DomUtil.hasClass(l,this.cls.childrenNopad)||(e.hide?_.DomUtil.addClass(l,this.cls.hide):_.DomUtil.removeClass(l,this.cls.hide))}},this)},_addItem:function(e){},_update:function(){return this._container?(_.Control.Layers.prototype._update.call(this),this._addTreeLayout(this._baseTree,!1),this._addTreeLayout(this._overlaysTree,!0),this._localExpand()):this},_addTreeLayout:function(e,t){var s;e&&(s=t?this._overlaysList:this._baseLayersList,this._expandCollapseAll(t,this.options.collapseAll,this.collapseTree),this._expandCollapseAll(t,this.options.expandAll,this.expandTree),this._iterateTreeLayout(e,s,t,e.noShow),this._checkDisabledLayers)&&this._checkDisabledLayers()},_expandCollapseAll:function(t,e,s,l){var a,r=t?this._overlaysList:this._baseLayersList;l=l||this,e&&((a=document.createElement("div")).className="leaflet-layerstree-expand-collapse",r.appendChild(a),a.innerHTML=e,a.tabIndex=0,_.DomEvent.on(a,"click keydown",function(e){"keydown"===e.type&&32!==e.keyCode||(a.blur(),s.call(l,t),this._localExpand())},this))},_iterateTreeLayout:function(e,t,s,l){var a,r,i,n,o,h,d,c,p;function y(e,t,s,l){e=_.DomUtil.create(e,t,s);return l&&(e.innerHTML=l),e}e&&(a=y("div",this.cls.header,t),c=y("span"),p=y("span"),r=y("span",this.cls.closed,c,this.options.closedSymbol),i=y("span",this.cls.opened,c,this.options.openedSymbol),d=y("span",this.cls.space,null,this.options.spaceSymbol),this.options.selectorBack?(c.insertBefore(d,r),a.appendChild(p),a.appendChild(c)):(c.appendChild(d),a.appendChild(c),a.appendChild(p)),n=this.cls.hide,e.children?(o=y("div",this.cls.children,t),h=e.layer?c:a,_.DomUtil.addClass(h,this.cls.pointer),h.tabIndex=0,_.DomEvent.on(h,"click keydown",function(e){"keydown"===e.type&&32!==e.keyCode||(h.blur(),_.DomUtil.hasClass(i,n)?(_.DomUtil.addClass(r,n),_.DomUtil.removeClass(i,n),_.DomUtil.removeClass(o,n)):(_.DomUtil.removeClass(r,n),_.DomUtil.addClass(i,n),_.DomUtil.addClass(o,n)),this._localExpand())},this),e.children.forEach(function(e){var t=y("div",this.cls.node,o);this._iterateTreeLayout(e,t,s)},this)):_.DomUtil.addClass(c,this.cls.neverShow),d=y(e.layer?"label":"span",this.cls.label,p),e.layer&&(t=this._map.hasLayer(e.layer),p=(c=s?e.radioGroup:"leaflet-base-layers_"+_.Util.stamp(this))?this._createRadioElement(c,t):this._createCheckboxElement(t),this._layerControlInputs&&this._layerControlInputs.push(p),p.layerId=_.Util.stamp(e.layer),_.DomEvent.on(p,"click",this._onInputClick,this),d.appendChild(p)),y("span",this.cls.name,d,e.label),_.DomUtil.addClass(r,n),l)&&(_.DomUtil.addClass(a,this.cls.neverShow),_.DomUtil.addClass(o,this.cls.childrenNopad))},_createCheckboxElement:function(e){var t=document.createElement("input");return t.type="checkbox",t.className="leaflet-control-layers-selector",t.defaultChecked=e,t}}),_.control.layers.tree=function(e,t,s){return new _.Control.Layers.Tree(e,t,s)}}(L);